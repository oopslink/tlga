# 小学霸冒险记 2.0 — 需求分析与开发计划

> 基于《小学霸冒险记_完整手册2.0.docx》分析，对比现有系统差异，制定开发任务。
> 文档日期：2026-02-24

---

## 一、需求概述

手册 2.0 核心升级方向（原文）：

> 2.0版本在完整保留原有体系的基础上，新增「反思与创造」锚点和固定任务框架。数学的核心地位不变，奥数加成倍率机制完整保留。**新增模块是「加法」，不是「替换」。**

### 四项主要升级

| # | 新增内容 | 说明 |
|---|----------|------|
| 1 | **反思与创造锚点** | 全新每日必做类型，三选一：发现时刻 / 开放问题 / 方法日志 |
| 2 | **周一至周五固定任务框架** | 三个锚点（数学、语言、反思）均需触碰，完成全部额外奖励 |
| 3 | **每日策略三套方案** | 稳健版 / 均衡版 / 冲刺版，辅助决策 |
| 4 | **数学模式重命名** | 五种模式统一命名（普通/火焰/星光/钻石/王者）|

---

## 二、与现有系统差距分析（Gap Analysis）

### 2.1 现有系统能力

当前 App 已实现：

- 数学任务（多难度，奥数倍率机制）
- 语言任务（英语、法语等，组合奖励）
- 随机掉落任务（钢琴、写字、社交）
- 等级特权系统（Lv1-11+）
- 连击奖励系统
- 周挑战 + 副本系统
- 隐藏成就系统
- 大目标翻倍机制
- 进度单工作流（填写 → 提交 → 审批 → 结算）

### 2.2 缺失的新功能

| 功能 | 现状 | 目标 |
|------|------|------|
| **反思与创造锚点** | ❌ 不存在 | 新增独立任务类型 |
| **思维档案（ThinkingArchive）** | ❌ 不存在 | 记录反思内容，长期积累 |
| **方法日志（MethodLog）** | ❌ 不存在 | 三行模板，永久保存 |
| **三锚点全完成奖励** | ❌ 不存在 | +2金币 +10XP（已有锚点完成奖励但逻辑不同）|
| **数学模式统一命名** | ⚠️ 命名与文档不一致 | 对齐文档五模式命名 |
| **周日本周回顾** | ❌ 不存在 | 周日专属任务，5金币 |
| **法语连续3天奖励** | ⚠️ 现有连击逻辑不支持分语言类型 | +2金币 |
| **每周法语5次奖励** | ❌ 不存在 | +1星星 |

### 2.3 奖励数值全面对比与调整方案（✅ 已确认：全部按新数值调整）

**甲方已确认：旧数值一并调整，对齐手册2.0。**

#### 现有系统 vs 2.0 文档数值对比

| 任务类别 | 现有数值 | 2.0 文档数值 | 变化幅度 |
|----------|----------|--------------|----------|
| **数学 - 学校作业** | 5金币 | 1金币 | ↓ 80% |
| **数学 - 中等** | 10金币 | - (合并入火焰模式) | 重构 |
| **数学 - 困难** | 15金币 | - (合并入钻石/王者) | 重构 |
| **数学 - 竞赛** | 25金币 | - (合并入钻石/王者) | 重构 |
| **数学 - 奥数** | 40金币 | 4金币（星光/钻石/王者基础）| ↓ 90% |
| **奥数倍率×3最高** | ×2.0（olympiad）| ×3.0（王者模式）| ↑ 倍率更高 |
| **英语阅读** | 10金币 | 1金币 | ↓ 90% |
| **法语阅读** | 15金币 | 4金币（基础2+特别2）| ↓ 73% |
| **语言三连击奖励** | +20金币 | 完成3项+3金币 | ↓ 85% |
| **法语连续3天** | +30金币+2星 | +2金币（仅金币）| ↓ 93% |
| **法语每周5次** | +50金币+3星 | +1星（仅星星）| 重构 |
| **钢琴练习** | 15金币 | 1-2金币 | ↓ 87% |
| **写字练习** | 10金币 | 1-2金币 | ↓ 80% |
| **社交活动** | 10金币 | 2-3金币 | ↓ 70% |
| **作业奖励** | 10-20金币 | （文档未提及，可保留原有或移除）| 待定 |

#### ⚠️ 数值调整的重要数学影响

**每日参考收益（文档标注为单日数据）**：
- 稳健版：约50-80金币/天
- 均衡版：约150-200金币/天
- 冲刺版：约250-350金币/天

**用新数值推算冲刺版上限（王者模式×3.0）**：
- 数学（4金 ×3.0）= 12金
- 语言（法语4+英语1+背诵1=6，加3项奖励+3金，共9金 ×3.0）= 27金
- 反思（不受倍率影响，最多3金）= 3金
- 全锚点完成 = +2金
- 随机掉落（钢琴2+写字2 ×3.0）= 12金
- 连击奖励（3天+4金等）≈ 4金
- **合计 ≈ 60金/天**

> **结论**：新数值体系下，日收入约30-65金，远低于文档标注的50-350金。
> 有两种可能的解读：
> 1. **文档的参考收益基于旧数值体系**，调整后需重新设定参考收益范围
> 2. **文档的每任务金币是"基础价值"**，实际app实现时倍数更高（约×10量级）
>
> ✅ **已确认：选择方案B**，全按文档新数值实现，冲刺版上限约25-60金/天。文档中的参考收益数字（250-350金）为历史遗留，以实际实现值为准，不再参考。

---

## 三、新功能详细需求

### 3.1 反思与创造锚点（核心新功能）

**每日5-10分钟，三选一**：

| 形式 | 内容要求 | 金币 | 归档目标 |
|------|----------|------|----------|
| 🔍 发现时刻 | 今天的数学/生活观察，画下或写下 | 3金币 | 思维档案 |
| ❓ 开放问题 | 回答当天开放问题，2-3句话，写或画 | 2金币 | 思维档案 |
| 📓 方法日志 | 记录做题时摸索出的方法，三行模板 | 3金币 | 方法日志 |

**方法日志三行模板**：
```
第一行：我遇到了什么问题
第二行：我想到了什么方法
第三行：我觉得这个方法的原理是什么
```

**奖励逻辑**：不评判对错，只奖励「有没有认真想」。

### 3.2 三锚点固定框架

**周一至周五**每天必须触碰三个锚点：

```
锚点一：数学  ——  必选难度（五模式之一）
锚点二：语言  ——  自选类型（中/英/法/背诵，至少一项）
锚点三：反思与创造  ——  三选一
```

**完成全部三锚点** → 额外 **+2金币 +10XP**（"冒险正式开启"）

### 3.3 数学五模式标准命名

| 模式 | 内容 | 基础金币 | 倍率 |
|------|------|----------|------|
| ⬜ 普通模式 | 学校数学作业（未做奥数） | 1金币 | ×1.0 |
| 🔥 火焰模式 | 奥数简单版（正确率80%+） | 2-3金币 | ×1.5 |
| ⭐ 星光模式 | 奥数简单版（正确率100%） | 4金币 | ×2.0 |
| 💎 钻石模式 | 简单版+2道难题 | 4+金币 | ×2.5 |
| 👑 王者模式 | 简单版+3道及以上难题 | 4+金币 | ×3.0 |

**奥数 XP 额外奖励**：
- 连续一周完成奥数简单版 → 额外 5XP
- 每完成1道难题 → 额外 10XP + 20%概率随机掉落1⭐

### 3.4 语言锚点规则更新

| 任务类型 | 金币 | 备注 |
|----------|------|------|
| 中文阅读（含复述） | 1-2金币 | 基础1金币；深度/复述2金币 |
| 英语阅读 | 1金币 | 标准奖励 |
| 法语阅读（15分钟） | 4金币 | 基础2+特别加成2 |
| 法语连续3天 | +2金币 | 新增：连续坚持额外奖励 |
| 每周法语5次以上 | +1⭐ | 新增：每周额外星星 |
| 背诵 | 1金币 | 基础背诵 |
| 完成2项语言任务 | +2金币 | 组合奖励 |
| 完成3项语言任务 | +3金币 | 组合奖励 |

### 3.5 周日本周回顾

**每周日晚专属任务（5分钟，5金币）**：
1. 这周我最自豪的一件事是什么？
2. 这周我发现了什么有趣的事情或方法？
3. 下周我想做一件什么不同的事？

### 3.6 思维档案（ThinkingArchive）

新增数据存储，永久积累反思内容：

```typescript
interface ThinkingArchiveEntry {
  id: string
  date: string             // ISO 日期
  weekId: string           // 周 ID
  type: 'discovery' | 'open-question' | 'method-log'  // 反思类型
  content: string          // 主要内容
  // 仅 method-log 使用
  methodLog?: {
    problem: string        // 遇到了什么问题
    method: string         // 想到了什么方法
    principle: string      // 方法的原理
  }
  goldEarned: number       // 获得金币
  linkedDate?: string      // 关联的进度单日期
}
```

---

## 四、技术实现方案

### 4.1 数据模型变更

**DailyProgressSheet / DailyLog 新增字段**：

```typescript
// 新增锚点三字段
reflection?: {
  type: 'discovery' | 'open-question' | 'method-log'
  content: string
  methodLog?: {
    problem: string
    method: string
    principle: string
  }
  goldEarned: number       // 2 或 3 金币
}

// 新增全锚点完成标志
allAnchorsCompleted?: boolean   // 数学+语言+反思全完成
allAnchorsBonusGold?: number    // +2金币
allAnchorsBonusXp?: number      // +10XP

// 周末回顾
weeklyReview?: {
  completed: boolean
  answers: {
    proudest: string     // 问题1答案
    discovery: string    // 问题2答案
    nextWeek: string     // 问题3答案
  }
  goldEarned: number     // 5金币
}
```

**新增数据存储路径**：

```
/data/weeks/{weekId}/
├── thinking-archive.json       # 思维档案（所有条目）
└── weekly-review.json          # 周日回顾
```

### 4.2 引擎层变更

| 文件 | 变更类型 | 内容 |
|------|----------|------|
| `engine/constants.ts` | 修改 | 新增反思锚点常量、更新数学模式命名 |
| `engine/math-multiplier.ts` | 修改 | 更新五模式名称与描述文案 |
| `engine/language-bonus.ts` | 修改 | 新增法语连续3天、每周5次奖励逻辑 |
| `engine/reflection-anchor.ts` | 新增 | 反思锚点积分计算 |
| `engine/all-anchors-bonus.ts` | 新增 | 三锚点全完成奖励计算 |
| `engine/daily-aggregator.ts` | 修改 | 整合反思锚点、全锚点奖励到每日结算 |

### 4.3 类型层变更

| 文件 | 变更内容 |
|------|----------|
| `types/index.ts` | 新增 `ThinkingArchiveEntry`、`WeeklyReview` 类型 |
| `types/tasks.ts` | 扩展 `DailyProgressSheet`，新增 `reflection`、`weeklyReview` 字段 |

### 4.4 Store 层变更

| Store | 变更内容 |
|-------|----------|
| `stores/progress.store.ts` | 支持保存/读取 reflection 字段，全锚点检测逻辑 |
| `stores/thinking-archive.store.ts` | 新增：管理思维档案的增删查 |

### 4.5 UI 层变更

| 页面/组件 | 变更内容 |
|-----------|----------|
| `pages/ProgressPage.vue` | 新增「锚点三：反思与创造」填写区域 |
| `pages/ApprovePage.vue` | 新增反思内容审阅区域（只读+备注） |
| `pages/DashboardPage.vue` | 新增思维档案入口卡片，显示最近记录 |
| `pages/HistoryPage.vue` | 显示历史反思内容 |
| 新增 `pages/ThinkingArchivePage.vue` | 思维档案全量查阅页 |

---

## 五、开发任务分解（优先级排序）

### P0 — 核心功能（必须实现）

| # | 任务 | 涉及文件 | 估算规模 |
|---|------|----------|----------|
| T1 | 新增反思锚点数据类型 | `types/tasks.ts`、`types/index.ts` | S |
| T2 | 新增反思锚点计分引擎 | `engine/reflection-anchor.ts`（新建） | S |
| T3 | 新增全锚点奖励逻辑 | `engine/all-anchors-bonus.ts`（新建） | S |
| T4 | 更新每日结算引擎整合新锚点 | `engine/daily-aggregator.ts` | M |
| T5 | 进度填写页新增锚点三UI | `pages/ProgressPage.vue` | M |
| T6 | 审批页新增反思内容查阅 | `pages/ApprovePage.vue` | S |
| T7 | Progress Store 支持反思字段 | `stores/progress.store.ts` | S |

### P1 — 重要功能（本迭代实现）

| # | 任务 | 涉及文件 | 估算规模 |
|---|------|----------|----------|
| T8 | 思维档案 Store | `stores/thinking-archive.store.ts`（新建） | S |
| T9 | 思维档案页面 | `pages/ThinkingArchivePage.vue`（新建） | M |
| T10 | Dashboard 显示思维档案卡片 | `pages/DashboardPage.vue` | S |
| T11 | 数学模式统一命名 | `engine/constants.ts`、`engine/math-multiplier.ts` | S |
| T12 | 法语连续3天 & 每周5次奖励 | `engine/language-bonus.ts` | S |
| T13 | 周日本周回顾任务 | 新增类型 + ProgressPage + engine | M |

### P2 — 优化完善（后续迭代）

| # | 任务 | 涉及文件 | 估算规模 |
|---|------|----------|----------|
| T14 | 方法日志三行模板特殊UI | `pages/ProgressPage.vue` | S |
| T15 | 历史页显示反思内容 | `pages/HistoryPage.vue` | S |
| T16 | 每日策略三方案提示功能 | Dashboard | M |
| T17 | 新增相关单元测试 | `tests/engine/` | M |

---

## 六、实现细节 — 反思锚点 UI 设计

### ProgressPage 新增区域

```
┌──────────────────────────────────────────┐
│  💡 锚点三：反思与创造（三选一）          │
│                                          │
│  ○ 🔍 发现时刻（+3金币）                  │
│  ○ ❓ 开放问题（+2金币）                  │
│  ● 📓 方法日志（+3金币）                  │
│                                          │
│  ╔══════════════════════════════════╗   │
│  ║ 我遇到了什么问题：              ║   │
│  ║ [________________________]      ║   │
│  ║ 我想到了什么方法：              ║   │
│  ║ [________________________]      ║   │
│  ║ 我觉得这个方法的原理是：        ║   │
│  ║ [________________________]      ║   │
│  ╚══════════════════════════════════╝   │
└──────────────────────────────────────────┘
```

### Dashboard 思维档案卡片

```
┌──────────────────────────────────────────┐
│  📚 思维档案                    [查看全部]│
│  ──────────────────────────────────────  │
│  📓 方法日志  02-24              +3金币   │
│  "用面积法解决了鸡兔同笼问题..."           │
│  ──────────────────────────────────────  │
│  🔍 发现时刻  02-23              +3金币   │
│  "发现乘法交换律在生活中的体现..."         │
└──────────────────────────────────────────┘
```

---

## 七、风险与已/待确认事项

### ✅ 所有问题已确认，可以开发

| # | 问题 | 确认结果 |
|---|------|----------|
| 1 | 旧数值是否一并调整？ | ✅ 是，全部按2.0文档数值调整（方案B） |
| 2 | 奥数倍率是否对反思锚点生效？ | ✅ 否，反思锚点不受倍率影响 |
| 3 | 参考收益50-350是单日还是单周？ | ✅ 单日（文档历史数字，以实现为准）|
| 4 | 周末进度单是否需要填写？ | ✅ 需要填写 |
| 5 | 作业任务是否保留？ | ✅ 保留，数值一并调整 |
| 6 | 开放问题来源？ | ✅ 支持系统预设 + 口头告知（可留空）|

### 🔴 技术风险

1. **数据兼容性**：新增 `reflection` 字段需向后兼容旧进度单数据
2. **存储扩展**：思维档案随时间累积，localStorage 容量需关注（建议添加超限提示）
3. **法语连续天数统计**：跨周计算法语连续天数需要读取历史数据

---

## 八、最终数值规格（开发直接参照）

### 数学锚点（新五模式）

| 模式 | 内容 | 基础金币 | 倍率 | 旧名 |
|------|------|----------|------|------|
| ⬜ 普通模式 | 学校数学作业 | **1金** | ×1.0 | basic |
| 🔥 火焰模式 | 奥数简单版80%+ | **2金** | ×1.5 | (新) |
| ⭐ 星光模式 | 奥数简单版100% | **4金** | ×2.0 | olympiad |
| 💎 钻石模式 | 简单版+2难题 | **4金** | ×2.5 | (新) |
| 👑 王者模式 | 简单版+3+难题 | **4金** | ×3.0 | (新) |

> 火焰模式80%+实得2金，100%按星光模式4金计算。
> 每道难题额外 +10XP，20%概率掉落1⭐（不计入金币）。

### 语言锚点

| 任务 | 金币 | 旧值 |
|------|------|------|
| 中文阅读（基础） | **1金** | - |
| 中文阅读（深度/复述） | **2金** | - |
| 英语阅读 | **1金** | 10金 |
| 法语阅读15分钟 | **4金**（基础2+特别2）| 15金 |
| 背诵 | **1金** | - |
| 完成2项语言任务 | **+2金** | 组合奖励 |
| 完成3项语言任务 | **+3金** | 原+20金 |
| 法语连续3天 | **+2金** | +30金+2星 |
| 每周法语5次以上 | **+1⭐** | +50金+3星 |

### 反思与创造锚点（新增，不受奥数倍率影响）

| 形式 | 金币 |
|------|------|
| 🔍 发现时刻 | **3金** |
| ❓ 开放问题 | **2金** |
| 📓 方法日志 | **3金** |

### 随机掉落任务

| 任务 | 金币 | 旧值 |
|------|------|------|
| 钢琴练习20分钟 | **1金** | 15金 |
| 钢琴练习30分钟+ | **2金** | 15金 |
| 写字练习20分钟 | **1金** | 10金 |
| 写字练习40分钟+ | **2金** | 10金 |
| 社交-有礼貌 | **2金** | 10金 |
| 社交-处理矛盾 | **3金+15XP** | 10金 |

### 全锚点完成奖励（周一至周五）

| 条件 | 奖励 |
|------|------|
| 数学+语言+反思三锚点全部完成 | **+2金+10XP** |

### 作业任务（保留，数值调整）

| 质量 | 金币 | 旧值 |
|------|------|------|
| 完美（perfect） | **4金** | 20金 |
| 良好（good） | **3金** | 15金 |
| 一般（ok） | **2金** | 10金 |
| 未完成 | 0金 | 0金 |
| 自查加成 | **+1金** | +5金 |

### 周日本周回顾（新增）

| 任务 | 金币 |
|------|------|
| 完成三个问题的周回顾 | **5金** |

### 开放问题管理（新增功能）

- 家长可在**设置页**预设每日开放问题文本
- 进度单中显示当日预设问题（如有）
- 孩子填写开放问题内容时，问题文本**可以留空**（口头告知场景）

---

## 九、文件变更清单总览

### 新建文件

```
src/engine/reflection-anchor.ts       # 反思锚点计分
src/engine/all-anchors-bonus.ts       # 三锚点全完成奖励
src/stores/thinking-archive.store.ts  # 思维档案 Store
src/pages/ThinkingArchivePage.vue     # 思维档案页面
tests/engine/reflection-anchor.test.ts  # 引擎单元测试
```

### 修改文件

```
src/types/index.ts                    # 新增 ThinkingArchiveEntry、WeeklyReview 类型
src/types/tasks.ts                    # 扩展 DailyProgressSheet
src/engine/constants.ts               # 更新数学模式命名常量
src/engine/math-multiplier.ts         # 更新模式名称文案
src/engine/language-bonus.ts          # 新增法语连续/每周奖励
src/engine/daily-aggregator.ts        # 整合反思锚点+全锚点奖励
src/stores/progress.store.ts          # 支持反思字段读写
src/pages/ProgressPage.vue            # 新增锚点三填写UI
src/pages/ApprovePage.vue             # 新增反思内容审阅
src/pages/DashboardPage.vue           # 新增思维档案卡片
src/pages/HistoryPage.vue             # 显示历史反思内容
src/App.vue 或 router                 # 新增思维档案路由
```

---

## 十、建议开发顺序

```
第1步：类型定义（T1）
    ↓
第2步：引擎层（T2 → T3 → T4）
    ↓
第3步：Store层（T7 → T8）
    ↓
第4步：ProgressPage UI（T5）
    ↓
第5步：ApprovePage扩展（T6）
    ↓
第6步：思维档案页面（T9 → T10）
    ↓
第7步：其他奖励规则对齐（T11 → T12 → T13）
    ↓
第8步：单元测试（T17）
```

---

*文档由 Claude Code 生成，基于《小学霸冒险记_完整手册2.0.docx》分析。*
